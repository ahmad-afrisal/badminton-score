<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Badminton Single - Umpire Mode</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6">
    <h1 class="text-center font-bold text-gray-800 mb-4 uppercase tracking-wider">üè∏ Badminton Single Mode</h1>

    <div class="flex justify-between items-center mb-6 bg-gray-50 p-4 rounded-xl border border-gray-100">
      <div class="text-center w-1/3">
        <p class="text-xs font-bold text-blue-600 uppercase">Player 1</p>
        <p id="score1" class="text-5xl font-black text-gray-800">0</p>
        <p id="set1" class="text-xs font-bold text-gray-400 mt-1">Set: 0</p>
      </div>
      <div class="text-center">
        <p class="text-[10px] font-bold text-gray-400 mb-1">SET</p>
        <div class="flex gap-1 justify-center">
          <span id="set-ind-1" class="w-6 h-6 flex items-center justify-center rounded-full bg-blue-500 text-white text-xs font-bold">1</span>
          <span id="set-ind-2" class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-gray-500 text-xs font-bold">2</span>
          <span id="set-ind-3" class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-gray-500 text-xs font-bold">3</span>
        </div>
      </div>
      <div class="text-center w-1/3">
        <p class="text-xs font-bold text-green-600 uppercase">Player 2</p>
        <p id="score2" class="text-5xl font-black text-gray-800">0</p>
        <p id="set2" class="text-xs font-bold text-gray-400 mt-1">Set: 0</p>
      </div>
    </div>

    <div id="court-container" class="flex flex-col gap-2 mb-6 transition-all duration-500">
      <div id="row-p1" class="grid grid-cols-2 gap-2">
        <div id="p1-left" class="h-20 rounded-lg bg-gray-100 flex flex-col items-center justify-center border-2 border-transparent transition-all">
            <span class="text-[9px] text-blue-400 font-bold uppercase">P1 L</span>
        </div>
        <div id="p1-right" class="h-20 rounded-lg bg-gray-100 flex flex-col items-center justify-center border-2 border-transparent transition-all">
            <span class="text-[9px] text-blue-400 font-bold uppercase">P1 R</span>
        </div>
      </div>
      <div id="row-p2" class="grid grid-cols-2 gap-2">
        <div id="p2-left" class="h-20 rounded-lg bg-gray-100 flex flex-col items-center justify-center border-2 border-transparent transition-all">
            <span class="text-[9px] text-green-400 font-bold uppercase">P2 L</span>
        </div>
        <div id="p2-right" class="h-20 rounded-lg bg-gray-100 flex flex-col items-center justify-center border-2 border-transparent transition-all">
            <span class="text-[9px] text-green-400 font-bold uppercase">P2 R</span>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-4">
      <button onclick="addPoint(1)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all">Point P1</button>
      <button onclick="addPoint(2)" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all">Point P2</button>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <button onclick="undo()" class="bg-white border-2 border-gray-200 text-gray-700 font-bold py-2 rounded-xl hover:bg-gray-50 active:scale-95 transition-all">Undo</button>
      <button onclick="confirmReset()" class="bg-red-50 text-red-600 font-bold py-2 rounded-xl hover:bg-red-100 border border-red-100 active:scale-95 transition-all">Reset Match</button>
    </div>
  </div>

<script>
  let score1 = 0, score2 = 0;
  let set1 = 0, set2 = 0;
  let currentSet = 1;
  let server = 1;
  let isSwapped = false;
  let history = []; // Menyimpan riwayat pertandingan

  function updateUI() {
    document.getElementById('score1').innerText = score1;
    document.getElementById('score2').innerText = score2;
    document.getElementById('set1').innerText = 'Set: ' + set1;
    document.getElementById('set2').innerText = 'Set: ' + set2;

    for (let i = 1; i <= 3; i++) {
      const el = document.getElementById('set-ind-' + i);
      el.className = 'w-6 h-6 flex items-center justify-center rounded-full font-bold text-xs ' + 
                     (i === currentSet ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500');
    }

    const container = document.getElementById('court-container');
    container.className = isSwapped ? "flex flex-col-reverse gap-2 mb-6" : "flex flex-col gap-2 mb-6";

    ['p1-left','p1-right','p2-left','p2-right'].forEach(id => {
      document.getElementById(id).className = 'h-20 rounded-lg bg-gray-50 flex flex-col items-center justify-center border-2 border-transparent transition-all opacity-60';
      const tag = document.getElementById(id).querySelector('.server-tag');
      if(tag) tag.remove();
    });

    let boxId = (server === 1) 
      ? (score1 % 2 === 0 ? 'p1-right' : 'p1-left')
      : (score2 % 2 === 0 ? 'p2-right' : 'p2-left');

    const activeBox = document.getElementById(boxId);
    activeBox.classList.remove('opacity-60');
    activeBox.classList.add('bg-yellow-200', 'border-yellow-500', 'scale-105', 'z-10', 'opacity-100');
    activeBox.innerHTML += `<span class="server-tag text-[10px] font-black text-yellow-800 mt-1 animate-pulse">üè∏ SERVER</span>`;
  }

  function saveHistory() {
    // Simpan salinan data saat ini ke dalam array history
    history.push(JSON.stringify({ score1, score2, set1, set2, currentSet, server, isSwapped }));
  }

  function undo() {
    if (history.length === 0) {
      alert("Tidak ada aksi yang bisa di-undo.");
      return;
    }
    const lastState = JSON.parse(history.pop());
    score1 = lastState.score1;
    score2 = lastState.score2;
    set1 = lastState.set1;
    set2 = lastState.set2;
    currentSet = lastState.currentSet;
    server = lastState.server;
    isSwapped = lastState.isSwapped;
    updateUI();
  }

  function addPoint(player) {
    saveHistory(); // Simpan state sebelum poin bertambah
    if (player === 1) {
      score1++;
      server = 1;
    } else {
      score2++;
      server = 2;
    }
    checkSetWinner();
    updateUI();
  }

  function checkSetWinner() {
    const diff = Math.abs(score1 - score2);
    const isOver = ((score1 >= 21 || score2 >= 21) && diff >= 2) || score1 === 30 || score2 === 30;

    if (isOver) {
      let winner = (score1 > score2) ? 1 : 2;
      if (winner === 1) set1++; else set2++;

      if (set1 === 2 || set2 === 2) {
        alert('Game Over! Pemenang: Player ' + winner);
        resetGame();
      } else {
        alert('Set ' + currentSet + ' Selesai. Tukar Lapangan!');
        server = winner; 
        score1 = 0; score2 = 0;
        currentSet++;
        isSwapped = !isSwapped;
      }
    }
  }

  function confirmReset() {
    if (confirm("Reset seluruh pertandingan?")) resetGame();
  }

  function resetGame() {
    score1 = 0; score2 = 0;
    set1 = 0; set2 = 0;
    currentSet = 1;
    server = 1;
    isSwapped = false;
    history = [];
    updateUI();
  }

  updateUI();
</script>
</body>
</html>