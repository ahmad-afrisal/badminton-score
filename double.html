<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Badminton Doubles ‚Äì Umpire Mode</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

<div class="w-full max-w-lg bg-white rounded-2xl shadow-lg p-4">
  <h1 class="text-center font-bold text-lg mb-3">üè∏ Badminton Ganda ‚Äì Umpire Mode</h1>

  <!-- Player Names -->
  <div class="grid grid-cols-2 gap-2 text-sm mb-3">
    <input id="A1" placeholder="Team A - Player 1" class="border rounded p-1" />
    <input id="A2" placeholder="Team A - Player 2" class="border rounded p-1" />
    <input id="B1" placeholder="Team B - Player 1" class="border rounded p-1" />
    <input id="B2" placeholder="Team B - Player 2" class="border rounded p-1" />
  </div>

  <!-- Score -->
  <div class="flex justify-between items-center mb-2">
    <div class="text-center">
      <p class="text-sm">Team A</p>
      <p id="scoreA" class="text-4xl font-bold">0</p>
      <p id="setA" class="text-xs">Set: 0</p>
    </div>
    <div class="text-center">
      <p class="text-xs">SET</p>
      <div class="flex gap-1">
        <span id="set1" class="px-2 py-1 rounded bg-blue-500 text-white">1</span>
        <span id="set2" class="px-2 py-1 rounded bg-gray-200">2</span>
        <span id="set3" class="px-2 py-1 rounded bg-gray-200">3</span>
      </div>
    </div>
    <div class="text-center">
      <p class="text-sm">Team B</p>
      <p id="scoreB" class="text-4xl font-bold">0</p>
      <p id="setB" class="text-xs">Set: 0</p>
    </div>
  </div>

  <!-- Court -->
  <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
    <div id="A-left" class="h-20 rounded bg-gray-200 flex flex-col justify-center items-center transition-all duration-300"></div>
    <div id="A-right" class="h-20 rounded bg-gray-200 flex flex-col justify-center items-center transition-all duration-300"></div>
    <div id="B-left" class="h-20 rounded bg-gray-200 flex flex-col justify-center items-center transition-all duration-300"></div>
    <div id="B-right" class="h-20 rounded bg-gray-200 flex flex-col justify-center items-center transition-all duration-300"></div>
  </div>

  <!-- Controls -->
  <div class="grid grid-cols-2 gap-2">
    <button onclick="addPoint('A')" class="bg-blue-600 text-white rounded py-2">Point Team A</button>
    <button onclick="addPoint('B')" class="bg-green-600 text-white rounded py-2">Point Team B</button>
  </div>

  <div class="grid grid-cols-2 gap-2 mt-2">
    <button onclick="undo()" class="bg-yellow-400 rounded py-1">Undo</button>
    <button onclick="resetMatch()" class="bg-red-500 text-white rounded py-1">Reset</button>
  </div>
</div>

<script>
// ===== STATE =====
let scoreA = 0, scoreB = 0;
let setA = 0, setB = 0;
let currentSet = 1;
let serverTeam = 'A';
let serveSide = 'right'; // right | left
let history = [];

let playerNames = {
  A1: 'A1',
  A2: 'A2',
  B1: 'B1',
  B2: 'B2'
};


let players = {
  'A-right': 'A1',
  'A-left': 'A2',
  'B-right': 'B1',
  'B-left': 'B2'
};

function updatePlayerNames() {
  playerNames.A1 = document.getElementById('A1').value || 'A1';
  playerNames.A2 = document.getElementById('A2').value || 'A2';
  playerNames.B1 = document.getElementById('B1').value || 'B1';
  playerNames.B2 = document.getElementById('B2').value || 'B2';
}


// ===== UI RENDER =====
function renderCourt() {
  updatePlayerNames();

  ['A-left','A-right','B-left','B-right'].forEach(id => {
    const el = document.getElementById(id);
    const playerKey = players[id]; // A1, A2, B1, B2

    el.className =
      'h-20 rounded bg-gray-200 flex flex-col justify-center items-center transition-all duration-300';

    el.innerHTML = `
      <span class="transition-transform duration-300">
        ${playerNames[playerKey]}
      </span>
    `;
  });

  const activeId = serverTeam + '-' + serveSide;
  const activeEl = document.getElementById(activeId);
  activeEl.classList.add('bg-green-200','font-bold');
  activeEl.querySelector('span').classList.add('scale-110');
  activeEl.innerHTML += `<span class="text-xs animate-bounce">üè∏ Server</span>`;
}



function updateUI() {
  document.getElementById('scoreA').innerText = scoreA;
  document.getElementById('scoreB').innerText = scoreB;
  document.getElementById('setA').innerText = 'Set: ' + setA;
  document.getElementById('setB').innerText = 'Set: ' + setB;

  ['set1','set2','set3'].forEach((id, i) => {
    document.getElementById(id).className =
      'px-2 py-1 rounded ' + (i + 1 === currentSet ? 'bg-blue-500 text-white' : 'bg-gray-200');
  });

  renderCourt();
}

// ===== LOGIC =====

// function swapPlayers(team) {
//   const r = team + '-right';
//   const l = team + '-left';

//   [players[r], players[l]] = [players[l], players[r]];

//   // sisi servis ikut berubah karena posisi bertukar
//   serveSide = serveSide === 'right' ? 'left' : 'right';
// }

function swapPlayers(team) {
  const r = team + '-right';
  const l = team + '-left';
  [players[r], players[l]] = [players[l], players[r]];
}



function getServeSide(team) {
  const score = team === 'A' ? scoreA : scoreB;
  return score % 2 === 0 ? 'right' : 'left';
}

function getServeSide(score) {
  return score % 2 === 0 ? 'right' : 'left';
}


function swapCourtSides() {
  const tempRight = players['A-right'];
  const tempLeft  = players['A-left'];

  players['A-right'] = players['B-right'];
  players['A-left']  = players['B-left'];

  players['B-right'] = tempRight;
  players['B-left']  = tempLeft;
}

function resetPositionsForNewSet(winnerTeam) {
  if (winnerTeam === 'A') {
    players['A-right'] = 'A1';
    players['A-left']  = 'A2';
  } else {
    players['B-right'] = 'B1';
    players['B-left']  = 'B2';
  }

  serverTeam = winnerTeam;
  serveSide = 'right'; // 0 = genap
}


function checkSetWinner() {
  const diff = Math.abs(scoreA - scoreB);
  const finish =
    ((scoreA >= 21 || scoreB >= 21) && diff >= 2) ||
    scoreA === 30 || scoreB === 30;

  if (!finish) return;

  let winnerTeam;

  if (scoreA > scoreB) {
    setA++;
    winnerTeam = 'A';
  } else {
    setB++;
    winnerTeam = 'B';
  }

  // ‚úÖ TUKAR SISI LAPANGAN (HANYA SEKALI)
  swapCourtSides();

  // ‚úÖ SET SERVER AWAL SET BARU
  resetPositionsForNewSet(winnerTeam);

  // ‚úÖ RESET SKOR
  scoreA = 0;
  scoreB = 0;

  // ‚úÖ PINDAH KE SET BERIKUTNYA
  currentSet++;

  // ‚úÖ CEK AKHIR MATCH
  if (setA === 2 || setB === 2) {
    alert((setA === 2 ? 'Team A' : 'Team B') + ' menang pertandingan');
    resetMatch();
  }
}



function addPoint(team) {
  history.push({
    scoreA, scoreB, setA, setB, currentSet, serverTeam, serveSide,
    players: JSON.parse(JSON.stringify(players))
  });

  // tambah skor
  if (team === 'A') scoreA++;
  else scoreB++;

  if (team === serverTeam) {
    // üü¢ SERVER MENANG
    // pemain bertukar
    swapPlayers(team);

    // tentukan sisi servis BERDASARKAN SKOR
    const score = team === 'A' ? scoreA : scoreB;
    serveSide = getServeSide(score);

  } else {
    // üîµ PENERIMA MENANG ‚Üí SERVIS PINDAH
    serverTeam = team;

    // TIDAK swap pemain
    const score = team === 'A' ? scoreA : scoreB;
    serveSide = getServeSide(score);
  }

  checkSetWinner();
  updateUI();
}


function undo() {
  if (!history.length) return;
  const last = history.pop();

  scoreA = last.scoreA;
  scoreB = last.scoreB;
  setA = last.setA;
  setB = last.setB;
  currentSet = last.currentSet;
  serverTeam = last.serverTeam;
  serveSide = last.serveSide;
  players = JSON.parse(JSON.stringify(last.players));

  updateUI();
}


function resetMatch() {
  scoreA = 0;
  scoreB = 0;
  setA = 0;
  setB = 0;
  currentSet = 1;
  serverTeam = 'A';
  serveSide = 'right';
  history = [];
  updateUI();
}

updateUI();
</script>
</body>
</html>